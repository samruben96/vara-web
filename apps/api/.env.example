# Vara API Environment Variables
# Copy this file to .env and fill in the values

# Server Configuration
PORT=4000
NODE_ENV=development

# URLs
# API_URL: The URL where this API is hosted
# Development: http://localhost:4000
# Production: https://vara-api-yaqq.onrender.com
API_URL=http://localhost:4000

# WEB_URL: The frontend URL (CRITICAL for CORS)
# Must match exactly - no trailing slash!
# Development: http://localhost:3000
# Production: https://vara-web-eta.vercel.app
WEB_URL=http://localhost:3000

# Database
# Development: Local PostgreSQL
# Production: Use Supabase pooler connection string with ?pgbouncer=true
DATABASE_URL="postgresql://postgres:password@localhost:5432/vara?schema=public"

# For Prisma migrations (direct connection, not pooled)
# Production: Use port 5432 instead of 6543
DIRECT_URL="postgresql://postgres:password@localhost:5432/vara?schema=public"

# Prisma Query Logging
# Set to 'true' to enable SQL query logging (verbose - useful for debugging)
# Default: false (only errors and warnings are logged)
PRISMA_LOG_QUERIES=false

# Supabase Configuration
# Get these from your Supabase project settings
SUPABASE_URL=https://your-project.supabase.co
SUPABASE_SERVICE_KEY=your_supabase_service_role_key
SUPABASE_JWT_SECRET=your_jwt_secret

# Redis (for BullMQ background jobs)
REDIS_URL=redis://localhost:6379

# Face Recognition Service (DeepFace)
# Development: Local Docker container
# Production: Render service URL
DEEPFACE_SERVICE_URL=http://localhost:8001

# =============================================================================
# FACE DETECTION CONFIGURATION
# =============================================================================

# Minimum image dimension for face detection (pixels)
# Images smaller than this will be upscaled to improve detection
# Default: 480
FACE_MIN_IMAGE_DIMENSION=480

# Maximum image dimension for face detection (pixels)
# Images larger than this will be downscaled to prevent memory issues
# Default: 2048
FACE_MAX_IMAGE_DIMENSION=2048

# Whether to normalize EXIF orientation before face detection
# This ensures rotated images from cameras/phones are processed correctly
# Default: true
FACE_NORMALIZE_EXIF=true

# JPEG quality for preprocessed images (1-100)
# Higher quality = better face detection but larger files
# Default: 90
FACE_PREPROCESSING_QUALITY=90

# Minimum face detection confidence threshold (0.0 - 1.0)
# Lower values = more faces detected but potentially more false positives
# Default: 0.5 (relaxed from typical 0.8 for better detection rates)
FACE_MIN_CONFIDENCE=0.5

# Minimum face size as a percentage of the smallest image dimension
# Faces smaller than this percentage may not be detected
# Default: 0.05 (5% of image dimension)
FACE_MIN_SIZE_PERCENT=0.05

# =============================================================================
# IMAGE SCANNING CONFIGURATION
# =============================================================================

# TinEye Reverse Image Search (Primary - Recommended)
# Get your API key from: https://services.tineye.com/
TINEYE_API_KEY=your-tineye-api-key

# Google Vision API (Fallback)
# Get your API key from: https://console.cloud.google.com/
GOOGLE_VISION_API_KEY=your-google-vision-api-key

# Scan Engine Selection
# Options: 'tineye' | 'google-vision' | 'auto'
# - tineye: Always use TinEye (requires TINEYE_API_KEY)
# - google-vision: Always use Google Vision (requires GOOGLE_VISION_API_KEY)
# - auto: Use TinEye if API key is set, otherwise fall back to Google Vision
SCAN_ENGINE=auto

# TinEye Configuration (optional - defaults shown)
# TINEYE_LIMIT=50              # Max results per search (default: 50, max: 100)
# TINEYE_BACKLINK_LIMIT=10     # Max backlinks per match (default: 10)

# =============================================================================
# PERSON DISCOVERY CONFIGURATION
# =============================================================================

# SerpAPI key for Google Lens / Bing reverse image search
# Get your key at: https://serpapi.com/
# Used to discover person identity candidates from protected images
SERPAPI_API_KEY=

# Person discovery engine selection
# Options: 'serpapi' | 'off'
# - serpapi: Use SerpAPI with Google Lens and Bing reverse image search
# - off: Disable person discovery (only run TinEye on original image)
PERSON_DISCOVERY_ENGINE=serpapi

# Maximum candidates to fetch from SerpAPI per search
# Higher values = more API costs but better coverage
# Default: 20
PERSON_DISCOVERY_MAX_CANDIDATES=20

# Provider order for person discovery (comma-separated)
# Options: google_lens, bing_reverse_image
# First provider is tried first, others are fallbacks
# Default: google_lens,bing_reverse_image
PERSON_DISCOVERY_PROVIDER_ORDER=google_lens,bing_reverse_image

# Maximum TinEye expansion searches per scan
# Each PERSON_CANDIDATE can trigger a TinEye search
# Set lower to control costs
# Default: 10
MAX_TINEYE_EXPANSIONS=10

# Cache TTL for SerpAPI results in seconds
# Default: 86400 (24 hours)
SERPAPI_CACHE_TTL=86400

# =============================================================================
# FACECHECK.ID CONFIGURATION (Face Recognition Web Search)
# =============================================================================

# FaceCheck.id API key for face-based web search
# Get your key at: https://facecheck.id/
# Used to find other photos of a person's face across the web
FACECHECK_API_KEY=

# FaceCheck engine selection
# Options: 'facecheck' | 'off'
# - facecheck: Enable FaceCheck.id face search
# - off: Disable FaceCheck (default)
FACECHECK_ENGINE=off

# Demo mode: uses 100k face DB, no credits consumed
# Set to 'false' for production with real searches
# Default: true
FACECHECK_DEMO=true

# Minimum face match score threshold (0-100)
# Matches below this score are discarded
# Default: 70
# FACECHECK_MIN_SCORE=70

# =============================================================================
# OTHER EXTERNAL APIS
# =============================================================================

# OpenAI (for CLIP embeddings)
# OPENAI_API_KEY=your-openai-api-key

# Have I Been Pwned API (for breach checks)
# HIBP_API_KEY=your-hibp-api-key

# Deepfake Detection (provider TBD)
# DEEPFAKE_API_KEY=your-deepfake-api-key
